<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gojo Photo Gallery</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<h1>ðŸ“¸ Gojo Photo Gallery</h1>

<form id="uploadForm">
  <input type="file" name="photo" accept="image/*" required />
  <input type="text" name="name" placeholder="Photo Name" required />
  <textarea name="description" placeholder="Photo Description" rows="2" required></textarea>
  <button type="submit">Upload</button>
</form>

<div class="gallery" id="gallery"></div>

<script>
const form = document.getElementById('uploadForm');
const gallery = document.getElementById('gallery');

function linkify(text) {
  return text.replace(/(https?:\/\/[^\s]+)/g, url => `<a href="${url}" target="_blank">${url}</a>`);
}

async function loadGallery() {
  // List photos from Cloudinary
  const res = await fetch(`https://res.cloudinary.com/${CLOUDINARY_CLOUD_NAME}/image/list/gojo-photos.json`);
  const data = await res.json();
  gallery.innerHTML = '';
  data.resources.forEach(item => {
    const div = document.createElement('div');
    div.className = 'gallery-item';
    div.innerHTML = `
      <img src="${item.url}" onclick="window.open('${item.url}', '_blank')" />
      <h3>${item.public_id}</h3>
    `;
    gallery.appendChild(div);
  });
}

form.addEventListener('submit', async e => {
  e.preventDefault();
  const formData = new FormData(form);
  const res = await fetch('/.netlify/functions/upload', {
    method: 'POST',
    body: formData
  });
  const data = await res.json();
  if (data.success) {
    alert('Upload successful!');
    form.reset();
    loadGallery();
  } else {
    alert('Upload failed');
  }
});

loadGallery();
</script>

</body>
</html>
